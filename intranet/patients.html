<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Patients - Roblox Health Service</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../assets/css/nhsuk.min.css">
  <style>
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #d0d0d0; padding: 0.5rem; text-align: left; }
    th { cursor: pointer; background: #f7f7f7; }
    button { margin-right: 0.5rem; }
    input.edit-field, select.edit-field { width: 100%; box-sizing: border-box; }
    .badge {
      display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px; color: white; font-weight: bold;
    }
    .Stable { background-color: green; }
    .Critical { background-color: red; }
    .Recovering { background-color: orange; }
  </style>
</head>
<body class="nhsuk-body nhsuk-clearfix">

<header class="nhsuk-header" role="banner">
  <div class="nhsuk-width-container nhsuk-header__container">
    <div class="nhsuk-header__content">
      <span class="nhsuk-header__logo"><span class="nhsuk-header__logo-text">Roblox Health Service</span></span>
      <nav class="nhsuk-header__navigation" aria-label="Primary navigation">
        <ul class="nhsuk-header__navigation-list">
          <li class="nhsuk-header__navigation-item"><a class="nhsuk-header__navigation-link" href="dashboard.html">Dashboard</a></li>
          <li class="nhsuk-header__navigation-item"><a class="nhsuk-header__navigation-link" href="patients.html">Patients</a></li>
          <li class="nhsuk-header__navigation-item"><a class="nhsuk-header__navigation-link" href="add-patient.html">Add Patient</a></li>
          <li class="nhsuk-header__navigation-item"><a class="nhsuk-header__navigation-link" href="login.html">Logout</a></li>
        </ul>
      </nav>
    </div>
  </div>
</header>

<div class="nhsuk-width-container">
  <main class="nhsuk-main-wrapper">
    <h1 class="nhsuk-heading-xl">Patient List</h1>

    <label class="nhsuk-label" for="search">Search Patients</label>
    <input class="nhsuk-input" type="text" id="search" placeholder="Search by name...">

    <table>
      <thead>
        <tr>
          <th onclick="sortTable('name')">Name</th>
          <th onclick="sortTable('room')">Room</th>
          <th onclick="sortTable('presenting')">Presenting Condition</th>
          <th onclick="sortTable('diagnosis')">Diagnosis</th>
          <th onclick="sortTable('status')">Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="patientBody"></tbody>
    </table>

    <script>
      let patients = JSON.parse(localStorage.getItem('patients') || '[]');
      let sortAsc = true;
      let currentSort = 'name';
      const tableBody = document.getElementById('patientBody');

      function savePatients() {
        localStorage.setItem('patients', JSON.stringify(patients));
        renderTable();
      }

      function renderTable(filter = '') {
        tableBody.innerHTML = '';
        patients.forEach((p, index) => {
          if (p.name.toLowerCase().includes(filter)) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td><span>${p.name}</span></td>
              <td><span>${p.room}</span></td>
              <td><span>${p.presenting}</span></td>
              <td><span>${p.diagnosis}</span></td>
              <td><span class="badge ${p.status}">${p.status}</span></td>
              <td>
                <button onclick="editPatient(${index})">Edit</button>
                <button onclick="deletePatient(${index})">Delete</button>
              </td>
            `;
            tableBody.appendChild(tr);
          }
        });
      }

      function deletePatient(index) {
        if (confirm('Are you sure you want to delete this patient?')) {
          patients.splice(index, 1);
          savePatients();
        }
      }

      function editPatient(index) {
        const tr = tableBody.rows[index];
        const p = patients[index];
        tr.innerHTML = `
          <td><input class="edit-field" value="${p.name}"></td>
          <td><input class="edit-field" value="${p.room}"></td>
          <td><input class="edit-field" value="${p.presenting}"></td>
          <td><input class="edit-field" value="${p.diagnosis}"></td>
          <td>
            <select class="edit-field">
              <option ${p.status==='Stable'?'selected':''}>Stable</option>
              <option ${p.status==='Critical'?'selected':''}>Critical</option>
              <option ${p.status==='Recovering'?'selected':''}>Recovering</option>
            </select>
          </td>
          <td>
            <button onclick="saveEdit(${index}, this)">Save</button>
            <button onclick="renderTable(document.getElementById('search').value.toLowerCase())">Cancel</button>
          </td>
        `;
      }

      function saveEdit(index, btn) {
        const tr = btn.closest('tr');
        const inputs = tr.querySelectorAll('.edit-field');
        patients[index] = {
          name: inputs[0].value,
          room: inputs[1].value,
          presenting: inputs[2].value,
          diagnosis: inputs[3].value,
          status: inputs[4].value
        };
        savePatients();
      }

      function sortTable(column) {
        if (currentSort === column) sortAsc = !sortAsc;
        else { currentSort = column; sortAsc = true; }

        patients.sort((a,b)=>{
          if (a[column] < b[column]) return sortAsc?-1:1;
          if (a[column] > b[column]) return sortAsc?1:-1;
          return 0;
        });
        renderTable(document.getElementById('search').value.toLowerCase());
      }

      renderTable();

      // Search filter
      const searchInput = document.getElementById('search');
      searchInput.addEventListener('input', function() {
        renderTable(this.value.toLowerCase());
      });
    </script>

  </main>
</div>

<footer class="nhsuk-footer">
  <div class="nhsuk-width-container">
    <p class="nhsuk-body-s">Â© Roblox Health Service</p>
  </div>
</footer>

</body>
</html>
